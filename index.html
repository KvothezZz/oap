<html><head><base href="/"><meta charset="UTF-8"><title>Oap</title><link href="https://fonts.googleapis.com/css2?family=Varela+Round&amp;display=swap" rel="stylesheet"><style>
    @font-face {
        font-family: 'Rounded';
        src: url('https://fonts.googleapis.com/css2?family=Varela+Round&display=swap');
    }

    h1 {
        font-family: 'Varela Round', sans-serif;
        color: #FFFFFF;
        text-shadow: -1px -1px 0 #000,  
                     1px -1px 0 #000,
                     -1px 1px 0 #000,
                     1px 1px 0 #000;
        text-align: left;
        font-size: 2.5em;
        margin-bottom: 30px;
        margin-left: 0;
        letter-spacing: 1px;
    }

    .subtitle {
        font-family: 'Varela Round', sans-serif;
        color: #FFFFFF; 
        text-align: left;
        font-size: 1em;
        margin-top: -25px;
        margin-bottom: 30px;
        margin-left: 0;
        font-weight: 300;
        letter-spacing: 2px;
    }

    body {
        font-family: 'Segoe UI', Arial, sans-serif;
        margin: 0;
        padding: 20px;
        background: #024504;
        color: #FFFFFF;
    }

    .container {
        max-width: 1200px;
        width: 95%;
        margin: 0 auto;
        background: #047A07;
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        overflow-x: hidden;
        margin-left: auto !important;
        margin-right: auto !important;
        transition: all 0.3s ease;
    }

    /* Update container styles for mobile */
    @media (max-width: 768px) {
        .container {
            max-width: 100%;
            width: 100%;
            margin: 0;
            padding: 10px;
            border-radius: 0;
            margin-left: 0 !important;
            margin-right: 0 !important;
        }
    }

    .hamburger-menu {
        position: fixed;
        top: 20px;  
        left: 20px; 
        cursor: pointer;
        z-index: 1001;
        display: flex;
        flex-direction: column;
        gap: 3px;
        padding: 5px;
        width: 15px;
        height: 15px;
        background: #047A07;
        border-radius: 4px;
        box-sizing: content-box;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        justify-content: center; 
        transition: all 0.3s ease;
        box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }

    /* Adjust hamburger menu for mobile */
    @media (max-width: 768px) {
        .hamburger-menu {
            position: fixed;
            top: 15px;
            left: 15px;
            width: 20px;
            height: 20px;
            padding: 8px;
            z-index: 1002;
        }
    }

    .hamburger-line {
        width: 15px; 
        height: 1.5px; 
        background-color: #FFFFFF;
        transition: all 0.3s ease;
    }

    .side-menu {
        position: fixed;
        top: 0;
        left: -350px;
        width: 300px;
        height: 100vh;
        background-color: #047A07;
        box-shadow: 2px 0 10px rgba(0,0,0,0.3);
        transition: left 0.3s ease;
        z-index: 1000;
        padding: 80px 20px 20px;
        color: #FFFFFF;
        opacity: 0.95;
    }

    .side-menu.active {
        left: -10px;
        box-shadow: 4px 0 15px rgba(0,0,0,0.4);
    }

    /* Modify side menu for mobile */
    @media (max-width: 768px) {
        .side-menu {
            left: -100%;
            width: 80%;
            max-width: 300px;
            padding-top: 60px;
        }

        .side-menu.active {
            left: -5px;
        }
    }

    .menu-item {
        padding: 15px;
        border-bottom: 1px solid #eee;
        cursor: pointer;
        transition: background-color 0.3s ease;
        color: #FFFFFF;
    }

    .menu-item:hover {
        background-color: #024504;
    }

    .timeline-container {
        display: flex;
        flex-direction: column;
        gap: 20px;
        margin-top: 20px;
    }

    .timeline {
        position: relative;
        margin: 10px 0;
        padding: 20px;
        border: 1px solid #ddd;
        border-radius: 4px;
        overflow-x: auto;
        white-space: nowrap;
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 8px;
        transition: all 0.3s ease;
    }

    /* Adjust timeline for mobile */
    @media (max-width: 768px) {
        .timeline {
            padding: 10px;
            margin: 10px 0;
            overflow-x: scroll;
            -webkit-overflow-scrolling: touch;
        }
    }

    .timeline:hover {
        background: rgba(255, 255, 255, 0.15);
    }

    .timeline h3 {
        margin: 0 0 15px 0;
        color: #333;
        font-size: 16px;
        color: #FFFFFF;
    }

    .timeline-line {
        position: relative;
        height: 4px;
        background: #FFFFFF;
        margin: 20px 0;
        min-width: 1200px; 
    }

    /* Adjust timeline line for mobile */
    @media (max-width: 768px) {
        .timeline-line {
            min-width: 800px;
        }
    }

    .task-bar {
        position: absolute;
        height: 20px;
        background: #28a745;
        border-radius: 2px;
        top: -8px;
        z-index: 1;
        color: white;
        font-size: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.3s ease;
        overflow: hidden;         
        white-space: nowrap;      
        text-overflow: ellipsis;  
        padding: 0 4px;           
        box-sizing: border-box;   
        touch-action: manipulation;
        -webkit-tap-highlight-color: transparent;
        user-select: none;
        -webkit-user-select: none;
    }

    .task-bar.active {
        background: #75FA8D !important; 
    }

    .task-bar.completed {
        background: #7D3B01; 
    }

    .time-marks {
        display: flex;
        justify-content: space-between;
        margin-top: 10px;
        min-width: 1200px; 
    }

    /* Adjust time marks for mobile */
    @media (max-width: 768px) {
        .time-marks {
            min-width: 800px;
        }
    }

    .time-mark {
        font-size: 12px;
        color: #666;
        color: #FFFFFF;
    }

    .task-form {
        margin-bottom: 20px;
    }

    /* Adjust form elements for mobile */
    @media (max-width: 768px) {
        .task-form {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .task-form input,
        .task-form select,
        .task-form button,
        .calendar-button {
            width: 100%;
            height: 40px;
            margin: 5px 0;
            font-size: 16px; 
            padding: 8px 12px;
        }
    }

    .task-form input {
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        color: #FFFFFF;
        border-radius: 6px;
        transition: all 0.3s ease;
        padding: 8px;
    }

    .task-form input::placeholder {
        color: #FFFFFF;
        opacity: 0.7;
    }

    .task-form input:focus,
    .task-form button:focus,
    #taskDay:focus,
    #taskCategory:focus {
        background: rgba(255, 255, 255, 0.2);
        border-color: #FFFFFF;
    }

    .task-form button,
    #taskDay,
    #taskCategory,
    .calendar-button {
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        color: #FFFFFF;
        border-radius: 6px;
        transition: all 0.3s ease;
    }

    .calendar-button,
    .task-form input,
    .task-form select,
    .task-form button,
    button {
      touch-action: manipulation;
      -webkit-tap-highlight-color: transparent;
      user-select: none;
      -webkit-user-select: none;
    }

    .task-list {
        margin: 20px 0;
        border-bottom: 1px solid #ddd;
        padding-bottom: 20px;
    }

    .task {
        background: rgba(255, 255, 255, 0.1);
        color: #FFFFFF;
        transition: all 0.3s ease;
    }

    .task.active {
        background: #75FA8D;
        color: #024504;
    }

    .task.completed {
        background: #7D3B01; 
        color: white; 
    }

    button {
        background: #024504;
        color: #FFFFFF;
        border: none;
        padding: 10px 20px;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    button:hover {
        background: #047A07;
        transform: translateY(-2px);
    }

    .delete-btn {
        background: #dc3545;
    }

    .delete-btn:hover {
        background: #c82333;
    }

    .export-btn,
    .import-btn {
        background: #28a745;
    }

    .export-btn:hover,
    .import-btn:hover {
        background: #218838;
    }

    #fileInput {
        display: none;
    }

    .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0,0,0,0.5);
        z-index: 1000;
    }

    /* Adjust modal for mobile */
    @media (max-width: 768px) {
        .modal-content {
            width: 95%;
            max-height: 90vh;
            overflow-y: auto;
            padding: 15px;
            margin: 10px;
        }
    }

    .modal-content {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: #047A07;
        color: #FFFFFF;
        padding: 20px;
        border-radius: 12px;
        width: 80%;
        max-width: 500px;
        margin: 0 auto; 
        box-sizing: border-box; 
        box-shadow: 0 4px 16px rgba(0,0,0,0.4);
    }

    .modal-content h2 {
        margin: 0 0 15px 0;
        padding: 0;
    }

    .modal textarea {
        width: calc(100% - 16px); 
        height: 100px;
        margin: 10px 0;
        padding: 8px;
        resize: vertical;
        box-sizing: border-box; 
    }

    .modal-content button {
        margin: 10px 0;
        width: 100%;
    }

    .task-comment {
        font-size: 12px;
        color: #666;
        margin-top: 5px;
        font-style: italic;
    }

    .task.completed .task-comment,
    .task.completed .duration-counter {
        color: white; 
    }

    .close {
        cursor: pointer;
        position: absolute;
        right: 10px;
        top: 10px;
        font-size: 24px;
        color: #FFFFFF;
    }

    .task .duration-counter {
        font-size: 12px;
        color: #666;
        margin-left: 10px;
    }

    .active .duration-counter {
        color: #28a745;
        font-weight: bold;
    }

    /* Calendar Styles */
    .calendar-container {
        position: relative;
        display: inline-block;
        margin: 5px;
    }

    .calendar-button {
        padding: 8px;
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 4px;
        background: rgba(255, 255, 255, 0.1);
        cursor: pointer;
        width: 200px; 
        text-align: left;
        position: relative;
        font-family: Arial, sans-serif;
        color: #FFFFFF;
        appearance: none;
        -webkit-appearance: none;
        -moz-appearance: none;
    }

    /* Add dropdown arrow */
    .calendar-button::after {
        content: '';
        position: absolute;
        right: 10px;
        top: 50%;
        transform: translateY(-50%);
        width: 0;
        height: 0;
        border-left: 5px solid transparent;
        border-right: 5px solid transparent;
        border-top: 5px solid #666;
    }

    .calendar-button:hover {
        border-color: #999;
    }

    .calendar-button:focus {
        outline: none;
        border-color: #007bff;
    }

    .calendar-dropdown {
        display: none;
        position: absolute;
        top: 100%;
        left: 0;
        background: #047A07;
        border: 1px solid rgba(255, 255, 255, 0.2);
        box-shadow: 0 4px 16px rgba(0,0,0,0.4);
        z-index: 1000;
        width: 300px;
        padding: 10px;
    }

    /* Adjust calendar for mobile */
    @media (max-width: 768px) {
        .calendar-dropdown {
            width: 100%;
            left: 0;
        }
        
        .calendar-grid {
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
        }
        
        .calendar-day {
            padding: 8px;
            font-size: 14px;
        }
    }

    .calendar-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
    }

    .calendar-header button {
        padding: 4px 8px;
        background: #f0f0f0;
        border: none;
        cursor: pointer;
    }

    .calendar-grid {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 2px;
    }

    .calendar-day {
        padding: 5px;
        text-align: center;
        cursor: pointer;
        color: #FFFFFF;
        transition: all 0.3s ease;
    }

    .calendar-day:hover {
        background: #024504;
    }

    .calendar-day.selected,
    .calendar-day.today {
        background: #024504;
        color: #FFFFFF;
    }

    .month-year-selector {
        text-align: center;
        margin-bottom: 10px;
    }

    .rgb-input {
        margin-top: 10px;
        padding: 10px;
        background: #f5f5f5;
        border-radius: 4px;
    }

    .rgb-input input {
        width: 100px;
        padding: 5px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-family: monospace;
    }

    .rgb-input button {
        padding: 5px 10px;
        margin-left: 10px;
    }

    /* Add media query for small screens */
    @media (max-width: 768px) {
        .container {
            width: 100%;
            padding: 10px;
            margin: 0;
        }

        .timeline {
            padding: 10px;
            margin: 20px 0;
        }

        .task-form input,
        .task-form button,
        .task-form select {
            width: 100%;
            margin: 5px 0;
        }

        .task-form {
            display: flex;
            flex-direction: column;
        }
    }

    /* Add styles for detail action buttons */
    #detailActions {
        display: flex;
        gap: 10px;
        justify-content: flex-start;
        margin-top: 20px;
    }

    #detailActions button {
        flex: 1;
        max-width: 200px;
    }

    /* Animation classes for hamburger icon */
    .hamburger-menu.active .hamburger-line:nth-child(1) {
        transform: translate(0, 5px) rotate(45deg);
    }

    .hamburger-menu.active .hamburger-line:nth-child(2) {
        opacity: 0;
    }

    .hamburger-menu.active .hamburger-line:nth-child(3) {
        transform: translate(0, -5px) rotate(-45deg);
    }

    /* Add styles for task groups in all tasks modal */
    .task-date-group {
        margin-bottom: 20px;
        padding: 10px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 4px;
    }

    .task-date-group h3 {
        margin: 0 0 10px 0;
        color: #333;
    }

    .task-date-item {
        padding: 8px;
        margin: 5px 0;
        background: white;
        border-radius: 4px;
        border-left: 4px solid #FFFFFF;
    }

    .task-date-item.active {
        border-left-color: #75FA8D;
    }

    .task-date-item.completed {
        border-left-color: #7D3B01;
        color: white;
        background: #7D3B01;
    }

    /* Add styles for category management */
    .category-manager {
        margin-top: 20px;
    }

    .current-categories {
        margin-bottom: 20px;
    }

    #categoryList {
        list-style: none;
        padding: 0;
        margin: 10px 0;
    }

    #categoryList li {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 8px;
        margin: 5px 0;
        background: #f5f5f5;
        border-radius: 4px;
    }

    .delete-category {
        color: #dc3545;
        cursor: pointer;
        padding: 4px 8px;
        border-radius: 4px;
    }

    .delete-category:hover {
        background: #ffebee;
    }

    .add-category {
        display: flex;
        gap: 10px;
    }

    #newCategoryInput {
        flex-grow: 1;
        padding: 8px;
        border: 1px solid #ddd;
        border-radius: 4px;
    }

    .color-picker {
        margin: 10px 0;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
    }

    .color-palette {
        display: grid;
        grid-template-columns: repeat(12, 1fr);
        gap: 2px;
        margin: 10px 0;
        border: 1px solid #ddd;
        padding: 5px;
        border-radius: 4px;
    }

    .color-swatch {
        width: 100%;
        padding-bottom: 100%; 
        cursor: pointer;
        border-radius: 2px;
        transition: transform 0.1s;
    }

    .color-swatch:hover {
        transform: scale(1.2);
        z-index: 1;
    }

    .color-preview {
        width: 100px;
        height: 50px;
        border: 1px solid #ddd;
        border-radius: 4px;
        margin: 10px 0;
        transition: background-color 0.3s;
    }

    .rgb-controls {
        display: flex;
        gap: 20px;
        margin: 10px 0;
    }

    .rgb-column {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 5px;
    }

    .rgb-slider {
        display: flex;
        flex-direction: column;
        gap: 5px;
    }

    .rgb-slider input[type="range"] {
        width: 100%;
    }

    .selected-color {
        font-family: monospace;
        text-align: center;
        margin: 10px 0;
        padding: 5px;
        background: #f5f5f5;
    }

    /* Add styles for calendar with completed tasks indicators */
    .calendar-day.has-completed {
        background-color: #7D3B01;
        color: white;
        border-radius: 50%;
        cursor: pointer;
    }

    .calendar-day.has-completed:hover {
        background-color: #9D4B21;
    }

    /* Add styles for calendar with tasks indicators */
    .calendar-day.has-tasks {
        background-color: #007bff;
        color: white;
        border-radius: 50%;
        cursor: pointer;
    }

    .calendar-day.has-tasks:hover {
        background-color: #0056b3;
    }

    /* Adjust the calendar modal content width */
    #completedTasksCalendarModal .modal-content {
        max-width: 400px;
    }

    #completedTasksCalendar .calendar-dropdown {
        border: none;
        box-shadow: none;
    }

    /* Update scrollbar styles */
    ::-webkit-scrollbar {
        width: 8px;
        height: 8px;
    }

    ::-webkit-scrollbar-track {
        background: #024504;
    }

    ::-webkit-scrollbar-thumb {
        background: #047A07;
        border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
        background: #FFFFFF;
    }

    /* Add subtle transitions */
    * {
        transition: background-color 0.3s ease, transform 0.3s ease, box-shadow 0.3s ease;
    }
</style>
</head>
<body>
    <div class="hamburger-menu" onclick="toggleMenu()">
        <div class="hamburger-line"></div>
        <div class="hamburger-line"></div>
        <div class="hamburger-line"></div>
    </div>

    <div class="side-menu">
        <div class="menu-item" onclick="filterTasks(&apos;all&apos;)">All Tasks</div>
        <div class="menu-item" onclick="filterTasks(&apos;completed&apos;)">Completed Tasks</div>
        <div class="menu-item" onclick="openSettings()">Settings</div>
    </div>

    <div class="container">
        <h1>Oap</h1>
        <div class="subtitle">Organization And Productivity</div>
        
        <div class="task-form">
            <div id="taskDay" class="calendar-container">
                <button class="calendar-button">Calendar</button>
                <div class="calendar-dropdown"></div>
            </div>
            <input type="text" id="taskName" placeholder="Task name">
            <select id="taskCategory">
                <option value="Work">Work</option>
                <option value="Leisure">Leisure</option>
                <option value="Study">Study</option>
                <option value="Other">Other</option>
            </select>
            <input type="time" id="startTime" value="06:00">
            <input type="time" id="endTime" value="07:00">
            <button onclick="showTaskModal()">Create Task</button>
            <button onclick="exportTasks()" class="export-btn">Export Tasks</button>
            <button onclick="document.getElementById(&apos;fileInput&apos;).click()" class="import-btn">Import Tasks</button>
            <input type="file" id="fileInput" accept=".json" onchange="importTasks(event)">
        </div>

        <div class="task-list" id="taskList">
        </div>

        <div class="timeline-container">
            <div class="timeline">
                <h3>Monday</h3>
                <div class="timeline-line"></div>
                <div class="time-marks"></div>
            </div>

            <div class="timeline">
                <h3>Tuesday</h3>
                <div class="timeline-line"></div>
                <div class="time-marks"></div>
            </div>

            <div class="timeline">
                <h3>Wednesday</h3>
                <div class="timeline-line"></div>
                <div class="time-marks"></div>
            </div>

            <div class="timeline">
                <h3>Thursday</h3>
                <div class="timeline-line"></div>
                <div class="time-marks"></div>
            </div>

            <div class="timeline">
                <h3>Friday</h3>
                <div class="timeline-line"></div>
                <div class="time-marks"></div>
            </div>

            <div class="timeline">
                <h3>Saturday</h3>
                <div class="timeline-line"></div>
                <div class="time-marks"></div>
            </div>

            <div class="timeline">
                <h3>Sunday</h3>
                <div class="timeline-line"></div>
                <div class="time-marks"></div>
            </div>
        </div>
        
        <div id="taskDetailsModal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closeTaskDetailsModal()">&#xd7;</span>
                <h2>Task Details</h2>
                <div id="taskDetailsContent">
                    <p><strong>Task Name:</strong> <span id="detailTaskName"></span></p>
                    <p><strong>Date:</strong> <span id="detailTaskDate"></span></p>
                    <p><strong>Category:</strong> <span id="detailCategory"></span></p>
                    <p><strong>Start Time:</strong> <span id="detailStartTime"></span></p>
                    <p><strong>End Time:</strong> <span id="detailEndTime"></span></p>
                    <p><strong>Status:</strong> <span id="detailStatus"></span></p>
                    <p><strong>Duration:</strong> <span id="detailDuration"></span></p>
                    <p><strong>Comment:</strong></p>
                    <div id="detailComment" style="background: #f5f5f5; padding: 10px; border-radius: 4px; margin-top: 5px;"></div>
                    <div id="detailActions" style="margin-top: 20px;">
                        <!-- Buttons will be added dynamically -->
                    </div>
                </div>
            </div>
        </div>

    <!-- Add Modal -->
    <div id="taskModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeTaskModal()">&#xd7;</span>
            <h2>Add Task Details</h2>
            <textarea id="taskComment" placeholder="Add your comments here..."></textarea>
            <button onclick="createTaskWithComment()">Create Task</button>
        </div>
    </div>

    <!-- Add modal for all tasks -->
    <div id="allTasksModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeAllTasksModal()">&#xd7;</span>
            <h2>All Tasks</h2>
            <div id="allTasksContent"></div>
        </div>
    </div>

    <!-- Add modal for settings -->
    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeSettings()">&#xd7;</span>
            <h2>Settings</h2>
            <div id="settingsContent">
                <h3>Category Management</h3>
                <div class="category-manager">
                    <div class="current-categories">
                        <h4>Current Categories</h4>
                        <ul id="categoryList"></ul>
                    </div>
                    <div class="add-category">
                        <input type="text" id="newCategoryInput" placeholder="New category name">
                        <button onclick="showColorPicker()">Add Category</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="colorPickerModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeColorPicker()">&#xd7;</span>
            <h3>Choose Category Color</h3>
            <div class="color-picker">
                <div class="color-preview" id="colorPreview"></div>
                <div class="selected-color" id="selectedColor">#000000</div>
                <div class="rgb-controls">
                    <div class="rgb-column">
                        <div class="rgb-slider">
                            <label>Red:</label>
                            <input type="range" min="0" max="255" value="0" id="redSlider">
                            <span id="redValue">0</span>
                        </div>
                        <div class="rgb-slider">
                            <label>Green:</label>
                            <input type="range" min="0" max="255" value="0" id="greenSlider">
                            <span id="greenValue">0</span>
                        </div>
                        <div class="rgb-slider">
                            <label>Blue:</label>
                            <input type="range" min="0" max="255" value="0" id="blueSlider">
                            <span id="blueValue">0</span>
                        </div>
                    </div>
                </div>
                <div class="rgb-input">
                    <input type="text" id="rgbInput" placeholder="#000000">
                    <button onclick="applyManualRGB()">Apply</button>
                </div>
                <div class="color-palette"></div>
            </div>
            <button onclick="addCategoryWithColor()">Confirm</button>
        </div>
    </div>

<script>
function handleTouchInteraction(element, clickHandler) {
  let touchStartY = 0;
  let touchMoved = false;
  const touchThreshold = 5;

  element.addEventListener('touchstart', (e) => {
    touchStartY = e.touches[0].clientY;
    touchMoved = false;
  });

  element.addEventListener('touchmove', (e) => {
    const touchCurrentY = e.touches[0].clientY;
    if (Math.abs(touchCurrentY - touchStartY) > touchThreshold) {
      touchMoved = true;
    }
  });

  element.addEventListener('touchend', (e) => {
    if (!touchMoved) {
      clickHandler(e);
    }
  });
}

function loadCategories() {
  let categoryColors = JSON.parse(localStorage.getItem('category-colors')) || {
    'Work': '#055C25',
    'Study': '#5C5906',
    'Leisure': '#095C52',
    'Other': '#5C5C5C'
  };
  if (!localStorage.getItem('category-colors')) {
    localStorage.setItem('category-colors', JSON.stringify(categoryColors));
  }
  const categorySelect = document.getElementById('taskCategory');
  categorySelect.innerHTML = '';
  Object.keys(categoryColors).forEach(category => {
    const option = document.createElement('option');
    option.value = category;
    option.textContent = category;
    categorySelect.appendChild(option);
  });
  const categoryList = document.getElementById('categoryList');
  if (categoryList) {
    categoryList.innerHTML = '';
    Object.entries(categoryColors).forEach(([category, color]) => {
      const li = document.createElement('li');
      li.innerHTML = `
                <span style="color: ${color}">${category}</span>
                ${category !== 'Work' && category !== 'Study' && category !== 'Leisure' && category !== 'Other' ? `<span class="delete-category" onclick="deleteCategory('${category}')">×</span>` : ''}
            `;
      categoryList.appendChild(li);
    });
  }
}
function deleteCategory(category) {
  const categoryColors = JSON.parse(localStorage.getItem('category-colors')) || {};
  delete categoryColors[category];
  localStorage.setItem('category-colors', JSON.stringify(categoryColors));
  loadCategories();
}
function openSettings() {
  document.getElementById('settingsModal').style.display = 'block';
  loadCategories();
}
function closeSettings() {
  document.getElementById('settingsModal').style.display = 'none';
}
function showColorPicker() {
  const newCategory = document.getElementById('newCategoryInput').value.trim();
  if (!newCategory) {
    alert('Please enter a category name');
    return;
  }
  document.getElementById('colorPickerModal').style.display = 'block';
  const colorPalette = document.querySelector('.color-palette');
  colorPalette.innerHTML = '';
  for (let r = 0; r <= 255; r += 51) {
    for (let g = 0; g <= 255; g += 51) {
      for (let b = 0; b <= 255; b += 51) {
        const color = `rgb(${r},${g},${b})`;
        const swatch = document.createElement('div');
        swatch.className = 'color-swatch';
        swatch.style.backgroundColor = color;
        swatch.addEventListener('click', () => {
          document.getElementById('colorPreview').style.backgroundColor = color;
          document.getElementById('selectedColor').textContent = rgbToHex(r, g, b);
          document.getElementById('redSlider').value = r;
          document.getElementById('greenSlider').value = g;
          document.getElementById('blueSlider').value = b;
          updateSliderValues();
        });
        colorPalette.appendChild(swatch);
      }
    }
  }
  ['red', 'green', 'blue'].forEach(color => {
    document.getElementById(`${color}Slider`).addEventListener('input', updateColorFromSliders);
  });
}
function closeColorPicker() {
  document.getElementById('colorPickerModal').style.display = 'none';
}
function rgbToHex(r, g, b) {
  return '#' + [r, g, b].map(x => {
    const hex = x.toString(16);
    return hex.length === 1 ? '0' + hex : hex;
  }).join('');
}
function updateColorFromSliders() {
  const r = document.getElementById('redSlider').value;
  const g = document.getElementById('greenSlider').value;
  const b = document.getElementById('blueSlider').value;
  const color = `rgb(${r},${g},${b})`;
  document.getElementById('colorPreview').style.backgroundColor = color;
  document.getElementById('selectedColor').textContent = rgbToHex(r, g, b);
  updateSliderValues();
}
function updateSliderValues() {
  document.getElementById('redValue').textContent = document.getElementById('redSlider').value;
  document.getElementById('greenValue').textContent = document.getElementById('greenSlider').value;
  document.getElementById('blueValue').textContent = document.getElementById('blueSlider').value;
}
function applyManualRGB() {
  const input = document.getElementById('rgbInput').value;
  if (!/^#[0-9A-Fa-f]{6}$/.test(input)) {
    alert('Please enter a valid hex color code in the format #RRGGBB');
    return;
  }
  const r = parseInt(input.slice(1, 3), 16);
  const g = parseInt(input.slice(3, 5), 16);
  const b = parseInt(input.slice(5, 7), 16);
  document.getElementById('redSlider').value = r;
  document.getElementById('greenSlider').value = g;
  document.getElementById('blueSlider').value = b;
  document.getElementById('colorPreview').style.backgroundColor = input;
  document.getElementById('selectedColor').textContent = input.toUpperCase();
  updateSliderValues();
}
function addCategoryWithColor() {
  const newCategory = document.getElementById('newCategoryInput').value.trim();
  const color = document.getElementById('selectedColor').textContent;
  if (!newCategory || !color) {
    alert('Please enter both a category name and select a color');
    return;
  }
  const categoryColors = JSON.parse(localStorage.getItem('category-colors')) || {};
  categoryColors[newCategory] = color;
  localStorage.setItem('category-colors', JSON.stringify(categoryColors));
  closeColorPicker();
  loadCategories();
  document.getElementById('newCategoryInput').value = '';
}
let tasks = [];
let activeTimers = {};
let timerIntervals = {};
function getCurrentDate() {
  const now = new Date();
  return formatDateForTask(now);
}
function getSelectedDate() {
  const calendarContainer = document.querySelector('.calendar-container');
  return calendarContainer.dataset.selectedDate || getCurrentDate();
}
function loadTasksFromStorage() {
  const savedTasks = localStorage.getItem('timeline-tasks');
  if (savedTasks) {
    tasks = JSON.parse(savedTasks);
    renderTasks();
    renderTimelineBars();
  }
}
function saveTasksToStorage() {
  localStorage.setItem('timeline-tasks', JSON.stringify(tasks));
}
function initializeTimeMarks() {
  const timeMarkContainers = document.querySelectorAll('.time-marks');
  timeMarkContainers.forEach(container => {
    container.innerHTML = '';
    for (let hour = 6; hour <= 29; hour++) {
      const displayHour = hour % 24;
      const mark = document.createElement('div');
      mark.className = 'time-mark';
      mark.textContent = `${String(displayHour).padStart(2, '0')}:00`;
      container.appendChild(mark);
    }
  });
}
function timeToMinutes(timeStr) {
  const [hours, minutes] = timeStr.split(':').map(Number);
  let totalMinutes = hours * 60 + minutes;
  if (hours < 6) {
    totalMinutes += 24 * 60;
  }
  return totalMinutes;
}
function calculateDuration(startTime, endTime) {
  const start = timeToMinutes(startTime);
  const end = timeToMinutes(endTime);
  const durationMinutes = end - start;
  const hours = Math.floor(durationMinutes / 60);
  const minutes = durationMinutes % 60;
  return {
    hours,
    minutes,
    totalMinutes: durationMinutes
  };
}
function calculatePosition(startTime, endTime, task) {
  const timelineStart = 6 * 60;
  const timelineEnd = 29 * 60;
  const timelineWidth = document.querySelector('.timeline-line').offsetWidth;
  if (task?.status === 'completed') {
    const startMinutes = timeToMinutes(task.actualStartTime);
    const endMinutes = startMinutes + task.durationSeconds / 60;
    const totalTimelineMinutes = timelineEnd - timelineStart;
    const left = (timeToMinutes(task.startTime) - timelineStart) / totalTimelineMinutes * 100;
    const width = task.durationSeconds / 60 / totalTimelineMinutes * 100;
    return {
      left,
      width: Math.max(width, 0.5)
    };
  }
  const startMinutes = timeToMinutes(startTime);
  const endMinutes = timeToMinutes(endTime);
  const totalTimelineMinutes = timelineEnd - timelineStart;
  let left = (startMinutes - timelineStart) / totalTimelineMinutes * 100;
  let width = (endMinutes - startMinutes) / totalTimelineMinutes * 100;
  if (width <= 0) {
    width = 0.5;
  }
  return {
    left,
    width
  };
}
function importTasks(event) {
  const file = event.target.files[0];
  if (file) {
    const reader = new FileReader();
    reader.onload = function (e) {
      try {
        const importedTasks = JSON.parse(e.target.result);
        tasks = importedTasks;
        saveTasksToStorage();
        renderTasks();
        renderTimelineBars();
        event.target.value = '';
      } catch (error) {
        alert('Error importing tasks. Please make sure the file is valid JSON.');
      }
    };
    reader.readAsText(file);
  }
}
function showTaskModal() {
  const taskName = document.getElementById('taskName').value;
  const startTime = document.getElementById('startTime').value;
  const endTime = document.getElementById('endTime').value;
  if (!taskName || !startTime || !endTime) {
    alert('Please fill all fields');
    return;
  }
  document.getElementById('taskModal').style.display = 'block';
}
function closeTaskModal() {
  document.getElementById('taskModal').style.display = 'none';
}
function createTaskWithComment() {
  const taskName = document.getElementById('taskName').value;
  const startTime = document.getElementById('startTime').value;
  const endTime = document.getElementById('endTime').value;
  const comment = document.getElementById('taskComment').value;
  const category = document.getElementById('taskCategory').value;
  const selectedDateStr = document.querySelector('.calendar-container').dataset.selectedDate;
  if (!selectedDateStr) {
    alert('Please select a date from the calendar first');
    return;
  }
  const task = {
    id: Date.now(),
    name: taskName,
    startTime,
    endTime,
    comment,
    category,
    day: selectedDateStr,
    status: 'pending'
  };
  tasks.push(task);
  saveTasksToStorage();
  renderTasks();
  renderTimelineBars();
  document.getElementById('taskName').value = '';
  document.getElementById('taskComment').value = '';
  closeTaskModal();
}
function exportTasks() {
  const dataStr = JSON.stringify(tasks, null, 2);
  const dataUri = 'data:application/json;charset=utf-8,' + encodeURIComponent(dataStr);
  const exportFileDefaultName = 'tasks.json';
  const linkElement = document.createElement('a');
  linkElement.setAttribute('href', dataUri);
  linkElement.setAttribute('download', exportFileDefaultName);
  linkElement.click();
}
function deleteTask(taskId) {
  if (timerIntervals[taskId]) {
    clearInterval(timerIntervals[taskId]);
    delete timerIntervals[taskId];
    delete activeTimers[taskId];
  }
  tasks = tasks.filter(t => t.id !== taskId);
  saveTasksToStorage();
  renderTasks();
  renderTimelineBars();
}
function startTask(taskId) {
  const currentDate = getCurrentDate();
  const taskToStart = tasks.find(t => t.id === taskId);
  if (taskToStart.day !== currentDate) {
    alert(`Error: This task is scheduled for ${taskToStart.day}. Tasks can only be started on their scheduled day (today is ${currentDate}).`);
    return;
  }
  const todaysTasks = tasks.filter(t => t.day === currentDate).sort((a, b) => {
    const timeA = timeToMinutes(a.startTime);
    const timeB = timeToMinutes(b.startTime);
    return timeA - timeB;
  });
  const firstPendingTask = todaysTasks.find(t => t.status === 'pending');
  if (firstPendingTask && firstPendingTask.id !== taskId) {
    alert('Error: You must complete tasks in chronological order. Please start the earlier pending task first.');
    return;
  }
  tasks.forEach(task => {
    if (task.id === taskId) {
      task.status = 'active';
      const now = new Date();
      task.actualStartTime = `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;
      task.startTimestamp = now.getTime();
      activeTimers[taskId] = 0;
      timerIntervals[taskId] = setInterval(() => {
        activeTimers[taskId]++;
        updateTaskTimer(taskId);
      }, 1000);
    }
  });
  saveTasksToStorage();
  renderTasks();
  renderTimelineBars();
}
function updateTaskTimer(taskId) {
  const seconds = activeTimers[taskId];
  const hours = Math.floor(seconds / 3600);
  const minutes = Math.floor(seconds % 3600 / 60);
  const secs = seconds % 60;
  const timerElement = document.querySelector(`#timer-${taskId}`);
  if (timerElement) {
    timerElement.textContent = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
  }
}
function completeTask(taskId) {
  const task = tasks.find(t => t.id === taskId);
  if (task) {
    if (timerIntervals[taskId]) {
      clearInterval(timerIntervals[taskId]);
      delete timerIntervals[taskId];
    }
    const now = new Date();
    const currentTime = `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;
    task.originalStartTime = task.startTime;
    task.actualStartTime = task.actualStartTime;
    task.actualEndTime = currentTime;
    const durationSeconds = Math.round((now.getTime() - task.startTimestamp) / 1000);
    const hours = Math.floor(durationSeconds / 3600);
    const minutes = Math.floor(durationSeconds % 3600 / 60);
    const seconds = durationSeconds % 60;
    task.duration = `${hours}h ${minutes}m ${seconds}s`;
    task.durationSeconds = durationSeconds;
    task.status = 'completed';
    delete activeTimers[taskId];
    saveTasksToStorage();
    renderTasks();
    renderTimelineBars();
  }
}
function showTaskDetails(taskId) {
  const task = tasks.find(t => t.id === taskId);
  if (task) {
    const currentDate = getCurrentDate();
    const taskDate = task.day;
    let dateInfo = `${taskDate}`;
    if (taskDate === currentDate) {
      dateInfo += ' (Today)';
    }
    document.getElementById('detailTaskName').textContent = task.name;
    document.getElementById('detailTaskDate').textContent = dateInfo;
    document.getElementById('detailCategory').textContent = task.category;
    document.getElementById('detailStartTime').textContent = task.status === 'completed' ? `${task.startTime} (Actual: ${task.actualStartTime})` : task.startTime;
    document.getElementById('detailEndTime').textContent = task.status === 'completed' ? `${task.endTime} (Actual: ${task.actualEndTime})` : task.endTime;
    document.getElementById('detailStatus').textContent = task.status;
    document.getElementById('detailComment').textContent = task.comment || 'No comment added';
    let durationText = 'Not started';
    if (task.status === 'completed') {
      durationText = task.duration;
    } else if (task.status === 'active' && activeTimers[task.id] !== undefined) {
      const seconds = activeTimers[task.id];
      const hours = Math.floor(seconds / 3600);
      const minutes = Math.floor(seconds % 3600 / 60);
      const secs = seconds % 60;
      durationText = `${hours}h ${minutes}m ${secs}s (Running)`;
    }
    document.getElementById('detailDuration').textContent = durationText;
    const actionsContainer = document.getElementById('detailActions');
    actionsContainer.innerHTML = '';
    if (task.status === 'pending') {
      const startButton = document.createElement('button');
      startButton.textContent = 'Start Task';
      startButton.onclick = () => {
        startTask(task.id);
        closeTaskDetailsModal();
      };
      actionsContainer.appendChild(startButton);
    } else if (task.status === 'active') {
      const completeButton = document.createElement('button');
      completeButton.textContent = 'Complete Task';
      completeButton.onclick = () => {
        completeTask(task.id);
        closeTaskDetailsModal();
      };
      actionsContainer.appendChild(completeButton);
    }
    const deleteButton = document.createElement('button');
    deleteButton.textContent = 'Delete Task';
    deleteButton.className = 'delete-btn';
    deleteButton.onclick = () => {
      deleteTask(task.id);
      closeTaskDetailsModal();
    };
    actionsContainer.appendChild(deleteButton);
    document.getElementById('taskDetailsModal').style.display = 'block';
  }
}
function closeTaskDetailsModal() {
  document.getElementById('taskDetailsModal').style.display = 'none';
}
function getWeekDates(selectedDate) {
  const dates = [];
  const currentDate = new Date(selectedDate);
  for (let i = 0; i < 7; i++) {
    dates.push(new Date(currentDate));
    currentDate.setDate(currentDate.getDate() + 1);
  }
  return dates;
}
function updateTimelineHeaders(selectedDate) {
  const weekDates = getWeekDates(selectedDate);
  const timelines = document.querySelectorAll('.timeline');
  weekDates.forEach((date, index) => {
    const timeline = timelines[index];
    const header = timeline.querySelector('h3');
    const dayName = date.toLocaleDateString('en-US', {
      weekday: 'long'
    });
    const monthDate = date.getDate();
    const month = date.toLocaleDateString('en-US', {
      month: 'short'
    });
    header.textContent = `${dayName} (${monthDate} ${month})`;
  });
}
function renderTasks() {
  const taskList = document.getElementById('taskList');
  taskList.innerHTML = '';
}
function renderTimelineBars() {
  document.querySelectorAll('.timeline-line').forEach(timeline => {
    const existingBars = timeline.querySelectorAll('.task-bar');
    existingBars.forEach(bar => bar.remove());
  });
  const selectedDateStr = document.querySelector('.calendar-container').dataset.selectedDate;
  if (!selectedDateStr) return;
  const selectedDate = new Date(selectedDateStr);
  const weekDates = getWeekDates(selectedDate);
  const categoryColors = JSON.parse(localStorage.getItem('category-colors')) || {};
  tasks.forEach(task => {
    if (!task.day) return;
    const taskDate = new Date(task.day);
    const timelineIndex = weekDates.findIndex(date => formatDateForTask(date) === task.day);
    if (timelineIndex === -1) return;
    const timeline = document.querySelectorAll('.timeline-line')[timelineIndex];
    const {
      left,
      width
    } = calculatePosition(task.startTime, task.endTime, task);
    const taskBar = document.createElement('div');
    taskBar.className = `task-bar ${task.status}`;
    taskBar.style.left = `${left}%`;
    taskBar.style.width = `${width}%`;
    taskBar.dataset.taskId = task.id;
    if (task.status !== 'completed') {
      taskBar.style.backgroundColor = categoryColors[task.category] || '#28a745';
    }
    taskBar.textContent = task.name;
    if (task.status === 'completed') {
      taskBar.title = `${task.name} (Duration: ${task.duration})`;
    } else {
      taskBar.title = task.name;
    }
    handleTouchInteraction(taskBar, (e) => {
      e.preventDefault();
      showTaskDetails(task.id);
    });
    timeline.appendChild(taskBar);
  });
}
function formatDateForTask(date) {
  const offset = date.getTimezoneOffset();
  const adjustedDate = new Date(date.getTime() - offset * 60 * 1000);
  return adjustedDate.toISOString().split('T')[0];
}
function selectDate(year, month, day) {
  const date = new Date(year, month, day);
  const dayName = date.toLocaleDateString('en-US', {
    weekday: 'short'
  });
  document.querySelector('.calendar-button').textContent = `${day} ${date.toLocaleString('default', {
    month: 'short'
  })} ${year} (${dayName})`;
  document.querySelector('.calendar-dropdown').style.display = 'none';
  document.querySelector('.calendar-container').dataset.selectedDate = formatDateForTask(date);
  updateTimelineHeaders(date);
  renderTimelineBars();
}
function createCalendar() {
  const calendarButton = document.querySelector('.calendar-button');
  const calendarDropdown = document.querySelector('.calendar-dropdown');
  let currentDate = new Date();
  let currentYear = currentDate.getFullYear();
  let currentMonth = currentDate.getMonth();
  calendarButton.addEventListener('click', function (e) {
    e.stopPropagation();
    if (calendarDropdown.style.display === 'block') {
      calendarDropdown.style.display = 'none';
    } else {
      calendarDropdown.style.display = 'block';
      updateCalendar(currentYear, currentMonth);
    }
  });
  function updateCalendar(year, month) {
    const firstDay = new Date(year, month, 1);
    const lastDay = new Date(year, month + 1, 0);
    const startDay = firstDay.getDay();
    const totalDays = lastDay.getDate();
    const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
    let calendarHTML = `
            <div class="month-year-selector">
                <button onclick="event.stopPropagation(); updateCalendar(${year}, ${month - 1})">←</button>
                <span>${monthNames[month]} ${year}</span>
                <button onclick="event.stopPropagation(); updateCalendar(${year}, ${month + 1})">→</button>
            </div>
            <div class="calendar-grid">
                <div class="calendar-day">Su</div>
                <div class="calendar-day">Mo</div>
                <div class="calendar-day">Tu</div>
                <div class="calendar-day">We</div>
                <div class="calendar-day">Th</div>
                <div class="calendar-day">Fr</div>
                <div class="calendar-day">Sa</div>
        `;
    for (let i = 0; i < startDay; i++) {
      calendarHTML += '<div class="calendar-day"></div>';
    }
    for (let day = 1; day <= totalDays; day++) {
      const isToday = year === currentDate.getFullYear() && month === currentDate.getMonth() && day === currentDate.getDate();
      calendarHTML += `
                <div class="calendar-day${isToday ? ' today' : ''}"
                     onclick="event.stopPropagation(); selectDate(${year}, ${month}, ${day})">
                    ${day}
                </div>`;
    }
    calendarHTML += '</div>';
    calendarDropdown.innerHTML = calendarHTML;
  }
  window.updateCalendar = function (year, month) {
    if (month < 0) {
      month = 11;
      year--;
    } else if (month > 11) {
      month = 0;
      year++;
    }
    currentYear = year;
    currentMonth = month;
    updateCalendar(year, month);
  };
  updateCalendar(currentYear, currentMonth);
}
window.onload = function () {
  initializeTimeMarks();
  createCalendar();
  const today = new Date();
  const year = today.getFullYear();
  const month = today.getMonth();
  const day = today.getDate();
  const dayName = today.toLocaleDateString('en-US', {
    weekday: 'short'
  });
  document.querySelector('.calendar-button').textContent = `${day} ${today.toLocaleString('default', {
    month: 'short'
  })} ${year} (${dayName})`;
  document.querySelector('.calendar-container').dataset.selectedDate = formatDateForTask(today);
  updateTimelineHeaders(today);
  loadTasksFromStorage();
  renderTimelineBars();
  loadCategories();
  document.addEventListener('click', function (e) {
    const calendar = document.querySelector('.calendar-container');
    if (!calendar.contains(e.target)) {
      document.querySelector('.calendar-dropdown').style.display = 'none';
    }
  });
  document.addEventListener('click', function (event) {
    const menu = document.querySelector('.side-menu');
    const hamburger = document.querySelector('.hamburger-menu');
    if (!menu.contains(event.target) && !hamburger.contains(event.target) && menu.classList.contains('active')) {
      menu.classList.remove('active');
      hamburger.classList.remove('active');
    }
  });
  document.addEventListener('touchmove', (e) => {
    if (e.target.classList.contains('task-bar') || 
        e.target.classList.contains('calendar-button') ||
        e.target.tagName === 'BUTTON' ||
        e.target.tagName === 'INPUT' ||
        e.target.tagName === 'SELECT') {
      e.stopPropagation();
    }
  }, { passive: true });
  function adjustTaskBarClickHandling() {
    const taskBars = document.querySelectorAll('.task-bar');
    taskBars.forEach(bar => {
      handleTouchInteraction(bar, (e) => {
        e.preventDefault();
        const taskId = parseInt(bar.dataset.taskId);
        showTaskDetails(taskId);
      });
    });
  }
  adjustTaskBarClickHandling();
}
function toggleMenu() {
  const menu = document.querySelector('.side-menu');
  const hamburger = document.querySelector('.hamburger-menu');
  if (menu.classList.contains('active')) {
    menu.classList.remove('active');
    hamburger.classList.remove('active');
  } else {
    menu.classList.add('active');
    hamburger.classList.add('active');
  }
}
function showCompletedTasksCalendar() {
  const modal = document.createElement('div');
  modal.id = 'completedTasksCalendarModal';
  modal.className = 'modal';
  modal.innerHTML = `
        <div class="modal-content">
            <span class="close" onclick="closeCompletedTasksCalendar()">×</span>
            <h2>Select Date to View Completed Tasks</h2>
            <div class="calendar-container" id="completedTasksCalendar">
                <div class="calendar-dropdown" style="display: block; position: static; width: 100%; box-shadow: none;">
                </div>
            </div>
        </div>
    `;
  document.body.appendChild(modal);
  let currentDate = new Date();
  let currentYear = currentDate.getFullYear();
  let currentMonth = currentDate.getMonth();
  function updateCompletedTasksCalendar(year, month) {
    const firstDay = new Date(year, month, 1);
    const lastDay = new Date(year, month + 1, 0);
    const startDay = firstDay.getDay();
    const totalDays = lastDay.getDate();
    const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
    let calendarHTML = `
            <div class="month-year-selector">
                <button onclick="event.stopPropagation(); updateCompletedTasksCalendar(${year}, ${month - 1})">←</button>
                <span>${monthNames[month]} ${year}</span>
                <button onclick="event.stopPropagation(); updateCompletedTasksCalendar(${year}, ${month + 1})">→</button>
            </div>
            <div class="calendar-grid">
                <div class="calendar-day">Su</div>
                <div class="calendar-day">Mo</div>
                <div class="calendar-day">Tu</div>
                <div class="calendar-day">We</div>
                <div class="calendar-day">Th</div>
                <div class="calendar-day">Fr</div>
                <div class="calendar-day">Sa</div>
        `;
    for (let i = 0; i < startDay; i++) {
      calendarHTML += '<div class="calendar-day"></div>';
    }
    for (let day = 1; day <= totalDays; day++) {
      const dateStr = formatDateForTask(new Date(year, month, day));
      const hasCompletedTasks = tasks.some(task => task.day === dateStr && task.status === 'completed');
      const isToday = year === currentDate.getFullYear() && month === currentDate.getMonth() && day === currentDate.getDate();
      calendarHTML += `
                <div class="calendar-day${isToday ? ' today' : ''}${hasCompletedTasks ? ' has-completed' : ''}"
                     onclick="showCompletedTasksForDate('${dateStr}')">
                    ${day}
                </div>`;
    }
    calendarHTML += '</div>';
    calendarDropdown.innerHTML = calendarHTML;
  }
  window.updateCompletedTasksCalendar = function (year, month) {
    if (month < 0) {
      month = 11;
      year--;
    } else if (month > 11) {
      month = 0;
      year++;
    }
    currentYear = year;
    currentMonth = month;
    updateCompletedTasksCalendar(year, month);
  };
  updateCompletedTasksCalendar(currentYear, currentMonth);
  modal.style.display = 'block';
}
function closeCompletedTasksCalendar() {
  const modal = document.getElementById('completedTasksCalendarModal');
  if (modal) {
    modal.remove();
  }
}
function showCompletedTasksForDate(dateStr) {
  const completedTasks = tasks.filter(task => task.day === dateStr && task.status === 'completed');
  if (completedTasks.length === 0) {
    alert('No completed tasks for this date');
    return;
  }
  closeCompletedTasksCalendar();
  const taskList = document.getElementById('taskList');
  taskList.innerHTML = '';
  const dateObj = new Date(dateStr);
  const formattedDate = dateObj.toLocaleDateString('en-US', {
    weekday: 'long',
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  });
  completedTasks.forEach(task => {
    const taskElement = document.createElement('div');
    taskElement.className = 'task completed';
    const taskContent = `
            <strong>${formattedDate} - ${task.name}</strong> (${task.category})<br>
            ${task.startTime} - ${task.endTime}
            <div class="task-comment">${task.comment || ''}</div>
            <span class="duration-counter">Duration: ${task.duration}</span>
        `;
    taskElement.innerHTML = taskContent;
    taskList.appendChild(taskElement);
  });
}
function filterTasks(status) {
  if (status === 'completed') {
    showCompletedTasksCalendar();
  } else if (status === 'all') {
    showAllTasks();
  }
  toggleMenu();
}
function showAllTasks() {
  const modal = document.createElement('div');
  modal.id = 'allTasksCalendarModal';
  modal.className = 'modal';
  modal.innerHTML = `
        <div class="modal-content">
            <span class="close" onclick="closeAllTasksCalendar()">×</span>
            <h2>Select Date to View All Tasks</h2>
            <div class="calendar-container" id="allTasksCalendar">
                <div class="calendar-dropdown" style="display: block; position: static; width: 100%; box-shadow: none;">
                </div>
            </div>
        </div>
    `;
  document.body.appendChild(modal);
  let currentDate = new Date();
  let currentYear = currentDate.getFullYear();
  let currentMonth = currentDate.getMonth();
  function updateAllTasksCalendar(year, month) {
    const firstDay = new Date(year, month, 1);
    const lastDay = new Date(year, month + 1, 0);
    const startDay = firstDay.getDay();
    const totalDays = lastDay.getDate();
    const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
    const calendarDropdown = document.querySelector('#allTasksCalendar .calendar-dropdown');
    let calendarHTML = `
            <div class="month-year-selector">
                <button onclick="event.stopPropagation(); updateAllTasksCalendar(${year}, ${month - 1})">←</button>
                <span>${monthNames[month]} ${year}</span>
                <button onclick="event.stopPropagation(); updateAllTasksCalendar(${year}, ${month + 1})">→</button>
            </div>
            <div class="calendar-grid">
                <div class="calendar-day">Su</div>
                <div class="calendar-day">Mo</div>
                <div class="calendar-day">Tu</div>
                <div class="calendar-day">We</div>
                <div class="calendar-day">Th</div>
                <div class="calendar-day">Fr</div>
                <div class="calendar-day">Sa</div>
        `;
    for (let i = 0; i < startDay; i++) {
      calendarHTML += '<div class="calendar-day"></div>';
    }
    for (let day = 1; day <= totalDays; day++) {
      const dateStr = formatDateForTask(new Date(year, month, day));
      const hasTasks = tasks.some(task => task.day === dateStr);
      const isToday = year === currentDate.getFullYear() && month === currentDate.getMonth() && day === currentDate.getDate();
      calendarHTML += `
                <div class="calendar-day${isToday ? ' today' : ''}${hasTasks ? ' has-tasks' : ''}"
                     onclick="showTasksForDate('${dateStr}')">
                    ${day}
                </div>`;
    }
    calendarHTML += '</div>';
    calendarDropdown.innerHTML = calendarHTML;
  }
  window.updateAllTasksCalendar = function (year, month) {
    if (month < 0) {
      month = 11;
      year--;
    } else if (month > 11) {
      month = 0;
      year++;
    }
    currentYear = year;
    currentMonth = month;
    updateAllTasksCalendar(year, month);
  };
  updateAllTasksCalendar(currentYear, currentMonth);
  modal.style.display = 'block';
}
function closeAllTasksCalendar() {
  const modal = document.getElementById('allTasksCalendarModal');
  if (modal) {
    modal.remove();
  }
}
function showTasksForDate(dateStr) {
  const tasksForDate = tasks.filter(task => task.day === dateStr);
  if (tasksForDate.length === 0) {
    alert('No tasks for this date');
    return;
  }
  const modalContent = document.querySelector('#allTasksCalendarModal .modal-content');
  const calendarContainer = document.querySelector('#allTasksCalendar');
  calendarContainer.style.display = 'none';
  const taskContainer = document.createElement('div');
  taskContainer.id = 'allTasksContent';
  const dateObj = new Date(dateStr);
  const formattedDate = dateObj.toLocaleDateString('en-US', {
    weekday: 'long',
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  });
  const dateGroup = document.createElement('div');
  dateGroup.className = 'task-date-group';
  dateGroup.innerHTML = `
        <h3>${formattedDate}</h3>
        <button onclick="showAllTasksCalendar()" style="margin-bottom: 15px;">Back to Calendar</button>
    `;
  const sortedTasks = tasksForDate.sort((a, b) => {
    const timeA = timeToMinutes(a.startTime);
    const timeB = timeToMinutes(b.startTime);
    return timeA - timeB;
  });
  sortedTasks.forEach(task => {
    const taskElement = document.createElement('div');
    taskElement.className = `task-date-item ${task.status}`;
    let taskContent = `
            <strong>${task.name}</strong> (${task.category})<br>
            ${task.startTime} - ${task.endTime}
        `;
    if (task.comment) {
      taskContent += `<div class="task-comment">${task.comment}</div>`;
    }
    if (task.status === 'active') {
      taskContent += `<span class="duration-counter" id="timer-${task.id}">00:00:00</span>`;
    } else if (task.status === 'completed' && task.duration) {
      taskContent += `<span class="duration-counter">Duration: ${task.duration}</span>`;
    }
    taskElement.innerHTML = taskContent;
    taskElement.onclick = () => showTaskDetails(task.id);
    dateGroup.appendChild(taskElement);
  });
  taskContainer.appendChild(dateGroup);
  modalContent.appendChild(taskContainer);
}
</script>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
</div></body></html>
